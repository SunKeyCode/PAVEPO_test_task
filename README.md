# Тестовое задание для компании PAVEPO

## Задача

Реализовать сервис по загрузке аудио-файлов от пользователей, используя FastAPI,
SQLAlchemy и Docker. Пользователи могут давать файлам имя в самом API.
Авторизацию пользователей реализовать через Яндекс.
Файлы хранить локально, хранилище использовать не нужно.
Использовать асинхронный код.
БД - PostgreSQL 16.

Ожидаемый результат:

1. Готовое API с возможностью авторизации через Яндекс с последующей аутентификацией к
   запросам через внутренние токены API.
   Доступные эндпоинты: авторизация через яндекс, обновление внутреннего access_token;
   получение, изменение данных пользователя, удаление пользователя от имени
   суперпользователя; получение информации о аудио файлах пользователя: название файлов
   и путь в локальное хранилище.
2. Документация по развертыванию сервиса и БД в Docker.

Все коммиты вести от самого начала разработки. Код разместить в GitHub в открытом
репозитории / дать доступ в приватный.

## Решение

### Основные технологии использованные в проекте

- Fastapi
- SqlAlchemy
- Postgres (версия 16)
- Pydantic
- alembic
- uv

Пользователь может войти в приложение по аккаунту в Yandex ID, при помощи запрашиваемого
кода подтверждения. Если запрашиваемый аккаунт Yandex ID отсутствует в системе - он
создается, а так же создается сам пользователь. Вход суперпользователя реализован
осуществляется с помощью логина и пароля (создается при старте системы). Реализована
загрузка/выгрузка файлов, а также просмотр списка файлов по пользователю. При загрузке
файла есть возможность задать его имя.

### Запуск проекта

1. Скачать проект
2. Переименовать файл env.template в .env, при необходимости задать свои значения
   переменных (файл находится в корне проекта).
3. Выполнить docker compose up -d

Приложение будет доступно по адресу http://0.0.0.0:8000

Сваггер документация: http://0.0.0.0:8000/docs (для первой загрузки этой страницы может
понадобится включить VPN)

### API

- /api/v1/auth/yandex_auth (GET) - аутентификация через Yandex Id
- /api/v1/auth/login (POST) - вход по логину и паролю (для суперпользователя)
- /api/v1/auth/refresh_token (GET) - обновить внутренний токен
- /api/v1/users/me (GET) - информация о текущем пользователе
- /api/v1/users/ (GET) - список пользователей (доступно только суперпользователю)
- /api/v1/users/ (PATCH) - обновление данных пользователя (в текущей реализации только
  email и name)
- /api/v1/users/{user_id} (DELETE) - удалить пользователя (доступно только
  суперпользователю)
- /api/v1/files/download/{file_id} (GET) - скачать ранее загруженный файл
- /api/v1/files/upload (POST) - загрузить файл
- /api/v1/files/ (GET) - список файлов пользователя

ВНИМАНИЕ! Для получения кода подтверждения для эндпоинта /api/v1/auth/yandex_auth
пользователя необходимо перенаправлять
на https://oauth.yandex.ru/authorize?response_type=code&client_id=<client_id>, для
локальных тестов (без фронтэнда) можно вставлять это строку в браузер в котором
пользователь авторизован в Yandex аккаунте.

Работающий client_id можно взять из env.template файла.